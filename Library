--// Connections
local GetService = game.GetService
local Connect = game.Loaded.Connect
local Wait = game.Loaded.Wait
local Clone = game.Clone 
local Destroy = game.Destroy 

if (not game:IsLoaded()) then
	local Loaded = game.Loaded
	Loaded.Wait(Loaded)
end

--// Important
local Setup = {
	Transparency = 0.2,
	ThemeMode = "Dark",
	Size = nil,
}

local Theme = {
	Primary = Color3.fromRGB(30, 30, 30),
	Secondary = Color3.fromRGB(35, 35, 35),
	Component = Color3.fromRGB(40, 40, 40),
	Interactables = Color3.fromRGB(45, 45, 45),
	Tab = Color3.fromRGB(200, 200, 200),
	Title = Color3.fromRGB(240,240,240),
	Description = Color3.fromRGB(200,200,200),
	Shadow = Color3.fromRGB(0, 0, 0),
	Outline = Color3.fromRGB(40, 40, 40),
	Icon = Color3.fromRGB(220, 220, 220),
}

--// Services
local LocalPlayer = GetService(game, "Players").LocalPlayer
local Services = {
	Insert = GetService(game, "InsertService"),
	Tween = GetService(game, "TweenService"),
	Input = GetService(game, "UserInputService")
}

local Player = {
	Mouse = LocalPlayer:GetMouse(),
	GUI = LocalPlayer.PlayerGui
}

local function Tween(Object, Speed, Properties)
	return Services.Tween:Create(Object, TweenInfo.new(Speed, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), Properties):Play()
end

local function SetProperty(Object, Properties)
	for i, v in next, Properties do
		Object[i] = v
	end
	return Object
end

local function Multiply(Value, Amount)
	return UDim2.new(Value.X.Scale * Amount, Value.X.Offset * Amount, Value.Y.Scale * Amount, Value.Y.Offset * Amount)
end

--// Setup UI
local Screen
if identifyexecutor then
	Screen = Services.Insert:LoadLocalAsset("rbxassetid://18490507748")
else
	Screen = script.Parent
end

local cg = game:GetService("CoreGui")
for _, v in pairs(cg:GetChildren()) do
	if v.Name:find("ChloeX") then
		v:Destroy()
	end
end

Screen.Name = "ChloeX"
Screen.Main.Visible = false
Screen.Parent = cg

--// Toggle Button (Draggable)
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ChloeX_ToggleButton"
ToggleButton.Size = UDim2.new(0, 140, 0, 40)
ToggleButton.Position = UDim2.new(0, 20, 1, -60)
ToggleButton.AnchorPoint = Vector2.new(0, 1)
ToggleButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 16
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = "Open ChloeX"
ToggleButton.AutoButtonColor = true
ToggleButton.Parent = cg

local Corner = Instance.new("UICorner", ToggleButton)
Corner.CornerRadius = UDim.new(0, 8)
local Stroke = Instance.new("UIStroke", ToggleButton)
Stroke.Thickness = 1.4
Stroke.Color = Color3.fromRGB(80, 80, 120)

--// Drag logic for button
local dragging, dragInput, dragStart, startPos
local function update(input)
	local delta = input.Position - dragStart
	ToggleButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
ToggleButton.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = ToggleButton.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)
ToggleButton.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)
Services.Input.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)

--// UI Toggle
local MainUI = Screen.Main
local UIVisible = false
ToggleButton.MouseButton1Click:Connect(function()
	UIVisible = not UIVisible
	MainUI.Visible = UIVisible
	ToggleButton.Text = UIVisible and "Close ChloeX" or "Open ChloeX"
end)

--// Animation System
local Animations = {}
function Animations:Open(Window, Transparency)
	local Original = Setup.Size or Window.Size
	local Multiplied = Multiply(Original, 1.1)
	local Shadow = Window:FindFirstChildOfClass("UIStroke")
	SetProperty(Shadow, { Transparency = 1 })
	SetProperty(Window, { Size = Multiplied, GroupTransparency = 1, Visible = true })
	Tween(Shadow, .25, { Transparency = 0.5 })
	Tween(Window, .25, { Size = Original, GroupTransparency = Transparency or 0 })
end
function Animations:Close(Window)
	local Original = Window.Size
	local Multiplied = Multiply(Original, 1.1)
	local Shadow = Window:FindFirstChildOfClass("UIStroke")
	SetProperty(Window, { Size = Original })
	Tween(Shadow, .25, { Transparency = 1 })
	Tween(Window, .25, { Size = Multiplied, GroupTransparency = 1 })
	task.wait(.25)
	Window.Size = Original
	Window.Visible = false
end
function Animations:Component(Component, Custom)
	Connect(Component.InputBegan, function() 
		if Custom then
			Tween(Component, .25, { Transparency = .85 })
		else
			Tween(Component, .25, { BackgroundColor3 = Theme.Component })
		end
	end)
	Connect(Component.InputEnded, function() 
		if Custom then
			Tween(Component, .25, { Transparency = 1 })
		else
			Tween(Component, .25, { BackgroundColor3 = Theme.Component })
		end
	end)
end

--// Library
local Library = {}
function Library:CreateWindow(Settings)
	local Window = Clone(Screen:WaitForChild("Main"))
	local Sidebar = Window:FindFirstChild("Sidebar")
	local Holder = Window:FindFirstChild("Main")
	local Tab = Sidebar:FindFirstChild("Tab")
	local Components = Screen:FindFirstChild("Components")

	local Options, Examples = {}, {}
	for _, Example in next, Window:GetDescendants() do
		if Example.Name:find("Example") then
			Examples[Example.Name] = Example
		end
	end

	Setup.Transparency = Settings.Transparency or 0
	Setup.Size = Settings.Size
	Setup.ThemeMode = Settings.Theme or "Dark"

	SetProperty(Window, { Size = Settings.Size, Visible = true, Parent = Screen })
	Animations:Open(Window, Settings.Transparency or 0)

	function Options:GetLabels(Component)
		local Labels = Component:FindFirstChild("Labels")
		return Labels.Title, Labels.Description
	end

	function Options:AddButton(Settings)
		local Button = Clone(Components["Button"])
		local Title, Description = Options:GetLabels(Button)
		SetProperty(Title, { Text = Settings.Title })
		SetProperty(Description, { Text = Settings.Description })
		SetProperty(Button, { Parent = Settings.Tab, Visible = true })
		Button.MouseButton1Click:Connect(Settings.Callback)
		Animations:Component(Button)
	end

	function Options:AddToggle(Settings)
		local Toggle = Clone(Components["Toggle"])
		local Title, Description = Options:GetLabels(Toggle)
		local On = Toggle["Value"]
		local Main = Toggle["Main"]
		local Circle = Main["Circle"]
		local function Set(Value)
			if Value then
				Tween(Main, .2, { BackgroundColor3 = Color3.fromRGB(153,155,255) })
				Tween(Circle, .2, { Position = UDim2.new(1, -16, 0.5, 0) })
			else
				Tween(Main, .2, { BackgroundColor3 = Theme.Interactables })
				Tween(Circle, .2, { Position = UDim2.new(0, 3, 0.5, 0) })
			end
			On.Value = Value
		end
		Toggle.MouseButton1Click:Connect(function()
			local Value = not On.Value
			Set(Value)
			Settings.Callback(Value)
		end)
		Set(Settings.Default)
		SetProperty(Title, { Text = Settings.Title })
		SetProperty(Description, { Text = Settings.Description })
		SetProperty(Toggle, { Parent = Settings.Tab, Visible = true })
		Animations:Component(Toggle)
	end

	function Options:AddDropdown(Settings)
		local Dropdown = Clone(Components["Dropdown"])
		local Title, Description = Options:GetLabels(Dropdown)
		local Text = Dropdown["Main"].Options
		SetProperty(Title, { Text = Settings.Title })
		SetProperty(Description, { Text = Settings.Description })
		SetProperty(Dropdown, { Parent = Settings.Tab, Visible = true })
		Animations:Component(Dropdown)
		Dropdown.MouseButton1Click:Connect(function()
			local Example = Clone(Examples["DropdownExample"])
			SetProperty(Example, { Parent = Window })
			Animations:Open(Example, 0, true)
			for i, Option in next, Settings.Options do
				local Btn = Clone(Examples["DropdownButtonExample"])
				local T, D = Options:GetLabels(Btn)
				SetProperty(T, { Text = i })
				SetProperty(Btn, { Parent = Example.ScrollingFrame, Visible = true })
				D:Destroy()
				Btn.MouseButton1Click:Connect(function()
					Text.Text = i
					Settings.Callback(Option)
					Animations:Close(Example)
					task.wait(0.25)
					Example:Destroy()
				end)
				Animations:Component(Btn)
			end
		end)
	end

	function Options:AddInput(Settings)
		local Input = Clone(Components["Input"])
		local Title, Description = Options:GetLabels(Input)
		local TextBox = Input["Main"]["Input"]
		TextBox.FocusLost:Connect(function()
			Settings.Callback(TextBox.Text)
		end)
		SetProperty(Title, { Text = Settings.Title })
		SetProperty(Description, { Text = Settings.Description })
		SetProperty(Input, { Parent = Settings.Tab, Visible = true })
		Animations:Component(Input)
	end

	function Options:AddParagraph(Settings)
		local Paragraph = Clone(Components["Paragraph"])
		local Title, Description = Options:GetLabels(Paragraph)
		SetProperty(Title, { Text = Settings.Title })
		SetProperty(Description, { Text = Settings.Description })
		SetProperty(Paragraph, { Parent = Settings.Tab, Visible = true })
	end

	function Options:AddSection(Settings)
		local Section = Clone(Components["Section"])
		SetProperty(Section, { Text = Settings.Name, Parent = Settings.Tab, Visible = true })
	end

	function Options:AddTab(Settings)
		local Example = Examples["TabButtonExample"]
		local TabBtn = Clone(Example)
		local MainExample = Examples["MainExample"]
		local Main = Clone(MainExample)
		SetProperty(TabBtn["TextLabel"], { Text = Settings.Title })
		SetProperty(Main, { Parent = MainExample.Parent, Name = Settings.Title })
		SetProperty(TabBtn, { Parent = Example.Parent, Visible = true })
		TabBtn.MouseButton1Click:Connect(function()
			for _, m in next, Holder:GetChildren() do
				if m:IsA("CanvasGroup") then m.Visible = (m.Name == Settings.Title) end
			end
		end)
		return Main.ScrollingFrame
	end

	function Options:Notify(Settings)
		local Notification = Clone(Components["Notification"])
		local Title, Description = Options:GetLabels(Notification)
		SetProperty(Title, { Text = Settings.Title })
		SetProperty(Description, { Text = Settings.Description })
		SetProperty(Notification, { Parent = Screen["Frame"] })
		task.spawn(function()
			local Duration = Settings.Duration or 2
			Animations:Open(Notification, Setup.Transparency, true)
			task.wait(Duration)
			Animations:Close(Notification)
			task.wait(0.25)
			Notification:Destroy()
		end)
	end

	return Options
end

return Library
